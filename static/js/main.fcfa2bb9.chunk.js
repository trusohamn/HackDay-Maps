(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e,t,a){e.exports=a(115)},113:function(e,t,a){},115:function(e,t,a){"use strict";a.r(t);var n=a(2),o=a.n(n),r=a(79),l=a.n(r),c=a(46),i=o.a.createContext({});var s=function(e){var t=Object(n.useState)(null),a=Object(c.a)(t,2),r=a[0],l=a[1],s=Object(n.useState)(null),m=Object(c.a)(s,2),u=m[0],p=m[1],d=Object(n.useState)(!1),f=Object(c.a)(d,2),h=f[0],v=f[1],b=Object(n.useState)("explore"),E=Object(c.a)(b,2),y=E[0],w=E[1],x=Object(n.useState)(null),g=Object(c.a)(x,2),O=g[0],j=g[1],N={pointId:r,setPointId:l,redirect:u,setRedirect:p,mode:y,switchMode:function(){w("explore"===y?"edit":"explore")},data:O,setData:j,saveInHistory:h,setSaveInHistory:v};return o.a.createElement(i.Provider,{value:N},e.children)},m=a(80),u=a(81),p=a(90),d=a(82),f=a(91),h={url:{API_URL:"https://db-truso-map-space.herokuapp.com"}},v=h.url.API_URL;var b=function(e){var t=Object(n.useContext)(i);return"explore"===t.mode?"":o.a.createElement("div",null,o.a.createElement("form",{className:"container",onSubmit:function(e){e.preventDefault();var a=new URLSearchParams,n=!0,o=!1,r=void 0;try{for(var l,c=new FormData(e.target)[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var i=l.value;a.append(i[0],i[1])}}catch(s){o=!0,r=s}finally{try{n||null==c.return||c.return()}finally{if(o)throw r}}fetch(v+"/api/points",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(function(e){console.log("new point posted"),t.setData(null)})},action:"http://localhost:8000/api/points",method:"post"},o.a.createElement("div",{className:"flexcontainer"},o.a.createElement("h3",null,"Add new location  "),o.a.createElement("input",{className:"d-none",readOnly:!0,type:"number",step:"any",name:"lon",id:"lon",value:e.lon}),o.a.createElement("input",{className:"d-none",readOnly:!0,type:"number",step:"any",name:"lat",id:"lat",value:e.lat})),o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"name"},"Name:"),o.a.createElement("input",{required:!0,className:"form-control input-sm",placeholder:"place name",type:"text",name:"name",id:"name"})),o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"description"},"Description:"),o.a.createElement("input",{className:"form-control input-sm",placeholder:"place decription",type:"text",name:"description",id:"description"})),o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"type"},"Select type:"),o.a.createElement("select",{className:"form-control input-sm",id:"type",name:"type"},o.a.createElement("option",null,"camping"),o.a.createElement("option",null,"bonfire"),o.a.createElement("option",null,"view")))),o.a.createElement("div",{className:"flexcontainer"},o.a.createElement("button",{type:"submit",className:"btn btn-dark btn-bg"},"Add to the map"))))},E=a(83),y=a.n(E),w=a(84),x=a.n(w),g=a(85),O=a.n(g),j=a(49),N=a(15),S=(a(107),a(121)),I=a(89),k=a(92),D=a(88),C=a(120),P=a(122),L=a(74),R=a(60),F=a(123),A=a(75),U=h.url.API_URL,H={camping:y.a,bonfire:x.a,view:O.a},T=function(e){function t(e){var a;return Object(m.a)(this,t),(a=Object(p.a)(this,Object(d.a)(t).call(this,e))).state={lon:17.862083241832444,lat:59.30184823106963},a}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"componentDidMount",value:function(){var e=this,t=new C.a({source:new P.a({features:[]})}),a=new C.a({source:new P.a({features:[]})}),n=new S.a({target:this.refs.mapContainer,layers:[new k.a({source:new D.a}),t,a],view:new I.a({center:Object(N.d)([this.state.lon,this.state.lat]),zoom:11})});n.on("click",function(t){if("explore"===e.context.mode){var a=null;e.state.map.forEachFeatureAtPixel(t.pixel,function(e){console.log(e.get("id")),a=e.get("id")||null}),console.log(e.props.location),console.log(e.props.match);var n=null===a?"/location/":"/location/"+a;e.context.setSaveInHistory(!0),e.context.setRedirect(o.a.createElement(j.a,{to:n}))}else if("edit"===e.context.mode){var r=Object(N.h)(t.coordinate);console.log(r),e.setState({lon:r[0],lat:r[1]});var l=[],c=t.coordinate,i=new L.a({geometry:new R.a(c)});l.push(i),e.state.extraLayer.setSource(new P.a({features:l}))}}),this.setState({map:n,extraLayer:t,featuresLayer:a})}},{key:"componentDidUpdate",value:function(e,t,a){var n=this;null===this.context.data&&fetch(U+"/api/points").then(function(e){return e.json()}).then(function(e){var t=[];e.points.forEach(function(e){var a=new F.a({opacity:1,scale:.05,src:H[e.type]}),n=new A.b({image:a}),o=Object(N.d)(e.localisation),r=new L.a({id:e.id,geometry:new R.a(o),name:e.name,description:e.description,rating:e.rating});r.setStyle(n),t.push(r)}),n.state.featuresLayer.setSource(new P.a({features:t})),n.context.setData(e)}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",{ref:"mapContainer",id:"mapContainer"}),o.a.createElement(b,{lon:this.state.lon,lat:this.state.lat}))}}]),t}(o.a.Component);T.contextType=i;var M=T,_=h.url.API_URL;var q=function(e){var t=Object(n.useContext)(i),a=Object(n.useState)(""),r=Object(c.a)(a,2),l=r[0],s=r[1],m=Object(n.useState)(null),u=Object(c.a)(m,2),p=u[0],d=u[1];return Object(n.useEffect)(function(){if(s(""),t.data){var e=t.data.points.find(function(e){return e.id===t.pointId});d(e)}},[t.data,t.pointId]),p&&"edit"!==t.mode?o.a.createElement("div",{className:"flexcontainercolumn"},o.a.createElement("h1",null,p.name),o.a.createElement("p",null,p.description,o.a.createElement("br",null),"rating: ",p.rating),o.a.createElement("button",{type:"click",onClick:function(){console.log("Description fetch reviews"),fetch(_+"/api/points/"+t.pointId).then(function(e){return e.json()}).then(function(e){console.log(e.rev);var t=e.rev.map(function(e){return o.a.createElement("div",{className:"flexcontainercolumn"},o.a.createElement("br",null),o.a.createElement("h5",null,e.title),o.a.createElement("p",null," ",e.description," "),o.a.createElement("h5",null,"rated: ",e.rating))});s(t)})},className:"btn btn-dark btn-sm"},"Show reviews"),l,o.a.createElement("form",{className:"container",onSubmit:function(e){e.preventDefault();var a=new URLSearchParams,n=!0,o=!1,r=void 0;try{for(var l,c=new FormData(e.target)[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var i=l.value;a.append(i[0],i[1])}}catch(s){o=!0,r=s}finally{try{n||null==c.return||c.return()}finally{if(o)throw r}}fetch(_+"/api/points/"+t.pointId,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a}).then(function(){t.setData(null)})}},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"title"},"Title:"),o.a.createElement("input",{className:"form-control input-sm",placeholder:"title",required:!0,name:"title",id:"title"})),o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"description"},"Description:"),o.a.createElement("input",{className:"form-control input-sm",placeholder:"description",name:"description",id:"description"})),o.a.createElement("div",{className:"col-sm"},o.a.createElement("label",{htmlFor:"rating"},"Rating:"),o.a.createElement("input",{className:"form-control input-sm",placeholder:"1-10",required:!0,min:"1",max:"10",name:"rating",id:"rating",type:"number"}))),o.a.createElement("div",{className:"flexcontainer"},o.a.createElement("button",{type:"submit",className:" btn btn-dark btn-bg"},"Review")))):""};var J=function(e){var t=Object(n.useContext)(i);return Object(n.useEffect)(function(){var a=e.location.pathname.match(/[^\/]+$/)?e.location.pathname.match(/[^\/]+$/)[0]:null;console.log("pathpointid",a),t.saveInHistory&&(console.log("saving in the history"),e.history.push(e.location.pathname),t.setSaveInHistory(!1)),t.pointId!==a&&t.setPointId(a)},[e.location.pathname]),o.a.createElement("div",null,o.a.createElement(M,{location:e.location,match:e.match}),o.a.createElement(q,null))};var $=function(){var e=Object(n.useContext)(i),t="explore"===e.mode?"Edit map":"Explore";return o.a.createElement("div",{className:"App"},o.a.createElement("button",{id:"switch modes",onClick:e.switchMode},t),e.redirect,o.a.createElement(j.b,{path:"/",component:J}))},z=a(63);var B=function(){return o.a.createElement(s,null,o.a.createElement(z.a,{basename:"/HackDay-Maps"},o.a.createElement("nav",{className:"navbar navbar-dark bg-dark"},o.a.createElement("h1",{className:"text-light"},"Your Map Space")),o.a.createElement(j.b,{exact:!0,path:"/"},o.a.createElement(j.a,{to:"/location"})),o.a.createElement(j.b,{path:"/location",component:$})))};a(113),a(114);l.a.render(o.a.createElement(B,null),document.getElementById("root"))},83:function(e,t,a){e.exports=a.p+"static/media/039-tent.ebd03a54.svg"},84:function(e,t,a){e.exports=a.p+"static/media/010-bonfire.21b76057.svg"},85:function(e,t,a){e.exports=a.p+"static/media/009-binoculars.6b6a714c.svg"}},[[102,1,2]]]);
//# sourceMappingURL=main.fcfa2bb9.chunk.js.map