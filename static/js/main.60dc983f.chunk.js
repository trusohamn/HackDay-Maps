(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{120:function(e,t,n){e.exports=n(134)},132:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(89),c=n.n(r),l=n(90),o=n(91),s=n(107),u=n(92),m=n(110),d=n(21),p=i.a.createContext({});var h=function(e){var t=Object(a.useState)(null),n=Object(d.a)(t,2),r=n[0],c=n[1],l=Object(a.useState)("explore"),o=Object(d.a)(l,2),s=o[0],u=o[1],m=Object(a.useState)(null),h=Object(d.a)(m,2),b=h[0],f=h[1],g=Object(a.useState)(17.86208324183244),E=Object(d.a)(g,2),O=E[0],y=E[1],v=Object(a.useState)(59.30184823106963),k=Object(d.a)(v,2),w=k[0],j=k[1],x=Object(a.useState)(!1),C=Object(d.a)(x,2),I=C[0],P=C[1],L=Object(a.useState)(!1),N=Object(d.a)(L,2),T=N[0],S=N[1],A=Object(a.useState)(!1),_=Object(d.a)(A,2),R=_[0],U=_[1],D=Object(a.useState)(!1),z=Object(d.a)(D,2),V=z[0],B=z[1],F={pointId:r,setPointId:c,getPointIdData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;return b.find(function(t){return t._id==e})},mode:s,setMode:u,switchMode:function(){u("explore"===s?"edit":"explore")},data:b,setData:f,lon:O,setLon:y,lat:w,setLat:j,cyclingOn:I,setCyclingOn:P,hikingOn:T,setHikingOn:S,hikebikeOn:R,setHikebikeOn:U,hillshadingOn:V,setHillshadingOn:B};return i.a.createElement(p.Provider,{value:F},e.children)},b=n(68),f=n(69),g={url:{API_URL:"https://db-truso-map-space.herokuapp.com"},app_id:{FACEBOOK_APPID:"383464965621720"}},E={isAuthenticated:!0,user:"5d2cd2dd1a88bd3129ed41cd",picture:"https://graph.facebook.com/10219128370309728/picture?type=large",jwToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVkMmNkMmRkMWE4OGJkMzEyOWVkNDFjZCIsImlhdCI6MTU2MzY1NjM5MiwiZXhwIjoxNTYzNjYzNTkyfQ.oS_qwR9qmT183NoKemPAuWRCSiK1tIgapdwdKkFupv4"},O=i.a.createContext({});var y=function(e){var t=Object(a.useState)(!!Object({NODE_ENV:"production",PUBLIC_URL:"/Tently"}).REACT_APP_LOGEDIN),n=Object(d.a)(t,2),r=n[0],c=n[1],l=Object(a.useState)(Object({NODE_ENV:"production",PUBLIC_URL:"/Tently"}).REACT_APP_LOGEDIN?E.user:null),o=Object(d.a)(l,2),s=o[0],u=o[1],m=Object(a.useState)(Object({NODE_ENV:"production",PUBLIC_URL:"/Tently"}).REACT_APP_LOGEDIN?E.picture:null),p=Object(d.a)(m,2),h=p[0],b=p[1],f=Object(a.useState)(Object({NODE_ENV:"production",PUBLIC_URL:"/Tently"}).REACT_APP_LOGEDIN?E.jwToken:null),g=Object(d.a)(f,2),y={isAuthenticated:r,setIsAuthenticated:c,user:s,setUser:u,jwToken:g[0],setJwToken:g[1],picture:h,setPicture:b};return i.a.createElement(O.Provider,{value:y},e.children)};var v=function(e){Object(a.useContext)(p);var t=Object(a.useContext)(O),n=function(){return e.inputs.reduce(function(e,t){return e[t.name]=t.default||"",e},{})},r=Object(a.useState)(n()),c=Object(d.a)(r,2),l=c[0],o=c[1],s=function(e){o(Object(f.a)({},l,Object(b.a)({},e.target.id,e.target.value)))};return i.a.createElement("div",null,i.a.createElement("form",{className:"container",onSubmit:function(a){a.preventDefault();var i=new URLSearchParams;for(var r in l)console.log(r,l[r]),i.append(r,l[r]);for(var c in e.additionalInputs)console.log(c,e.additionalInputs[c]),i.append(c,e.additionalInputs[c]);fetch(g.url.API_URL+e.apiPath,{method:"POST",credentials:"include",headers:{Authorization:"Bearer "+t.jwToken,"Content-Type":"application/x-www-form-urlencoded"},body:i}).then(function(t){o(n()),e.onSucessPost&&e.onSucessPost(t)})}},i.a.createElement("div",{className:"flexcontainer"},i.a.createElement("h3",null,e.formTitle)),i.a.createElement("div",{className:"row"},e.inputs.map(function(e){return i.a.createElement("div",{className:"col-sm",key:e.name},i.a.createElement("label",{htmlFor:e.name},e.label),e.selectType?i.a.createElement("select",{className:"form-control input-sm",id:e.name,name:e.name,value:l[e.name],onChange:s},e.options.map(function(e){return i.a.createElement("option",{key:e},e)})):i.a.createElement("input",{required:e.required,className:"form-control input-sm",placeholder:e.placeholder,type:e.type,name:e.name,id:e.name,value:l[e.name],onChange:s}))})),i.a.createElement("div",{className:"flexcontainer"},i.a.createElement("button",{type:"submit",className:"btn btn-dark btn-bg"},e.buttonTitle))))};var k=function(e){var t=Object(a.useContext)(p),n={lon:t.lon,lat:t.lat};return"explore"===t.mode?null:i.a.createElement(v,{onSucessPost:function(){return t.setData(null)},apiPath:"/api/points",formTitle:"Click on the map and add a new spot",additionalInputs:n,inputs:[{name:"name",label:"Name:",required:!0,placeholder:"place name",type:"text"},{name:"description",label:"Description:",required:!1,placeholder:"place decription",type:"text"},{name:"type",label:"Select type:",selectType:!0,options:["camping","bonfire","view","hut"],default:"camping"}],buttonTitle:"Add to the map"})},w=n(93);var j=function(e){return i.a.createElement(w.BallSpinner,{size:e.size,color:"#686769",loading:e.loading})},x=n(96),C=n.n(x),I=n(97),P=n.n(I),L=n(98),N=n.n(L),T=n(99),S=n.n(T),A=n(13),_=(n(129),n(140)),R=n(106),U=n(63),D=n(101),z=n(56),V=n(139),B=n(141),F=n(79),M=n(61),J=n(102),q=n(86),G=n(100),H=n(78),K=n(67),Y=n(142),Z=g.url.API_URL,W={camping:C.a,bonfire:P.a,view:N.a,hut:S.a},X=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).map=null,n.cyclingLayer=null,n.hikingLayer=null,n.hikebikeLayer=null,n.center=function(){n.map.getView().setCenter(Object(A.d)(n.context.getPointIdData().localisation)),n.map.getView().setZoom(13)},n}return Object(m.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=new V.a({source:new B.a({features:[]})}),n=new V.a({source:new B.a({features:[]})}),a=new F.a({geometry:new M.a([])}),i=new V.a({source:new B.a({features:[a]})});this.cyclingLayer=new U.a({source:new z.a({url:"http://tile.waymarkedtrails.org/cycling/{z}/{x}/{y}.png"})}),this.hikingLayer=new U.a({source:new z.a({url:"http://tile.waymarkedtrails.org/hiking/{z}/{x}/{y}.png"})}),this.hikebikeLayer=new U.a({source:new z.a({url:"http://tiles.wmflabs.org/hikebike/{z}/{x}/{y}.png"})}),this.hillshadingLayer=new U.a({source:new z.a({url:"http://tiles.wmflabs.org/hillshading/{z}/{x}/{y}.png"})}),this.map=new _.a({target:this.refs.mapContainer,layers:[new U.a({source:new D.a}),this.hikebikeLayer,this.hikingLayer,this.cyclingLayer,this.hillshadingLayer,t,n,i],view:new R.a({center:Object(A.d)([this.context.lon,this.context.lat]),zoom:6})});var r=new J.a({tracking:!0,projection:this.map.getView().getProjection()});r.on("change",function(e){var t=r.getPosition();a.getGeometry().setCoordinates(t)});this.map.on("click",function(t){if("explore"===e.context.mode){var n=null;e.map.forEachFeatureAtPixel(t.pixel,function(e){n=e.get("id")||null});var a=null===n?"/location/":"/location/"+n;e.props.history.push(a)}else if("edit"===e.context.mode){var i=Object(A.j)(t.coordinate);e.context.setLon(i[0]),e.context.setLat(i[1]);var r=new q.b({image:new G.a({fill:new H.a({color:"blue"}),stroke:new K.a({color:"#2F4F4F",width:2}),points:11,radius:10,radius2:3,angle:0})}),c=[],l=t.coordinate,o=new F.a({geometry:new M.a(l)});o.setStyle(r),c.push(o),e.state.extraLayer.setSource(new B.a({features:c}))}}),this.setState({extraLayer:t,featuresLayer:n,geoIcon:a})}},{key:"componentDidUpdate",value:function(){var e=this;this.cyclingLayer.setVisible(this.context.cyclingOn),this.hikingLayer.setVisible(this.context.hikingOn),this.hikebikeLayer.setVisible(this.context.hikebikeOn),this.hillshadingLayer.setVisible(this.context.hillshadingOn),(null===this.context.data||this.state.featuresLayer.values_.source.isEmpty())&&fetch(Z+"/api/points").then(function(e){return e.json()}).then(function(t){var n=[];t.forEach(function(e){var t=new Y.a({opacity:1,scale:.05,src:W[e.type]}),a=new q.b({image:t}),i=Object(A.d)(e.localisation),r=new F.a({id:e._id,geometry:new M.a(i),name:e.name,description:e.description,rating:e.rating});r.setStyle(a),n.push(r)}),e.state.featuresLayer.setSource(new B.a({features:n})),e.context.setData(t)}).catch(function(e){return console.log(e)})}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(j,{size:100,loading:!this.context.data}),i.a.createElement("div",{ref:"mapContainer",id:"mapContainer"}),this.context.pointId&&"edit"!==this.context.mode?i.a.createElement("button",{onClick:this.center},"center on location"):"",i.a.createElement(k,null))}}]),t}(i.a.Component);X.contextType=p;var $=X,Q=n(83),ee=n(70);function te(){var e=Object(Q.a)(["\n  border-radius: 100%;\n  height: 1.5em;\n"]);return te=function(){return e},e}function ne(){var e=Object(Q.a)(["\n  border-radius: 100%;\n  height: 3.5em;\n  margin: 0em 0.5em 0em 3em;\n"]);return ne=function(){return e},e}var ae=ee.default.img(ne()),ie=ee.default.img(te());var re=function(e){var t=Object(a.useContext)(O);return i.a.createElement("div",{className:"ReviewCard flexcontainercolumn"},i.a.createElement("br",null),i.a.createElement("h5",null,e.e.title),i.a.createElement("p",null," ",e.e.description," "),i.a.createElement("h5",null,"rated: ",e.e.rating),t.isAuthenticated?i.a.createElement(ie,{src:e.e.profilePicture,alt:"Profile"}):"")},ce=g.url.API_URL;var le=function(e){var t=Object(a.useContext)(p),n=Object(a.useContext)(O),r=Object(a.useState)(""),c=Object(d.a)(r,2),l=c[0],o=c[1],s=Object(a.useState)(null),u=Object(d.a)(s,2),m=u[0],h=u[1];Object(a.useEffect)(function(){if(o(""),t.data){var e=t.data.find(function(e){return e._id===t.pointId});h(e)}},[t.data,t.pointId]);var b=function(){fetch(ce+"/api/points/"+t.pointId).then(function(e){return e.json()}).then(function(e){var t=e.map(function(e,t){return i.a.createElement(re,{e:e,key:t})});o(t)})};return m&&"edit"!==t.mode?i.a.createElement("div",{className:"flexcontainercolumn"},i.a.createElement("h1",null,m.name),i.a.createElement("p",null,m.description),i.a.createElement("h5",null,"rating: ",m.rating),n.isAuthenticated?i.a.createElement("p",null,"created by: ",i.a.createElement(ie,{src:m.profilePicture,alt:"Profile"})):"",i.a.createElement("button",{type:"click",onClick:b,className:"btn btn-dark btn-sm"},"Show reviews"),l,n.isAuthenticated?i.a.createElement("form",{className:"container",onSubmit:function(e){e.preventDefault();var a=new URLSearchParams,i=!0,r=!1,c=void 0;try{for(var l,o=new FormData(e.target)[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var s=l.value;a.append(s[0],s[1])}}catch(u){r=!0,c=u}finally{try{i||null==o.return||o.return()}finally{if(r)throw c}}fetch(ce+"/api/points/"+t.pointId,{method:"POST",headers:{Authorization:"Bearer "+n.jwToken,"Content-Type":"application/x-www-form-urlencoded"},body:a,withCredentials:!0,credentials:"include"}).then(function(e){return e.json()}).then(function(e){h(Object(f.a)({},m,{rating:e.newRating})),b()})}},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-sm"},i.a.createElement("label",{htmlFor:"title"},"Title:"),i.a.createElement("input",{className:"form-control input-sm",placeholder:"title",required:!0,name:"title",id:"title"})),i.a.createElement("div",{className:"col-sm"},i.a.createElement("label",{htmlFor:"description"},"Description:"),i.a.createElement("input",{className:"form-control input-sm",placeholder:"description",name:"description",id:"description"})),i.a.createElement("div",{className:"col-sm"},i.a.createElement("label",{htmlFor:"rating"},"Rating:"),i.a.createElement("input",{className:"form-control input-sm",placeholder:"1-10",required:!0,min:"1",max:"10",name:"rating",id:"rating",type:"number"}))),i.a.createElement("div",{className:"flexcontainer"},i.a.createElement("button",{type:"submit",className:" btn btn-dark btn-bg"},"Review"))):""):""};var oe=function(e){var t=Object(a.useContext)(p),n=Object(a.useContext)(O);return Object(a.useEffect)(function(){var n=e.location.pathname.match(/[^\/]+$/)?e.location.pathname.match(/[^\/]+$/)[0]:null;t.pointId!==n&&"location"!==n&&t.setPointId(n)},[e.location.pathname]),i.a.createElement("div",null,i.a.createElement($,{history:e.history}),n.isAuthenticated&&t.pointId&&"edit"!==t.mode?i.a.createElement("button",{onClick:function(){var e=new URLSearchParams;e.append("locationId",t.pointId),fetch(g.url.API_URL+"/api/profiles/favourites",{method:"POST",headers:{Authorization:"Bearer "+n.jwToken,"Content-Type":"application/x-www-form-urlencoded"},body:e}).then(function(e){console.log(e)})}},"add to favourites"):"",i.a.createElement(le,null))},se=n(50);var ue=function(){var e=Object(a.useContext)(p),t=Object(a.useContext)(O),n="explore"===e.mode?"Edit map":"Explore",r=function(t){var n=t.target,a=n.checked;switch(n.name){case"cyclingOn":return e.setCyclingOn(a);case"hikingOn":return e.setHikingOn(a);case"hikebikeOn":return e.setHikebikeOn(a);case"hillshadingOn":return e.setHillshadingOn(a);default:return}};return i.a.createElement("div",{className:"App"},t.isAuthenticated?i.a.createElement("button",{id:"switch modes",onClick:e.switchMode},n):null,i.a.createElement("form",{id:"layers"},i.a.createElement("label",null,i.a.createElement("a",{href:"https://cycling.waymarkedtrails.org/"},"waymarkedtrails cycling"," "),i.a.createElement("input",{name:"cyclingOn",type:"checkbox",checked:e.cyclingOn,onChange:r})),i.a.createElement("label",null,i.a.createElement("a",{href:"https://hiking.waymarkedtrails.org/"},"waymarkedtrails hiking"," "),i.a.createElement("input",{name:"hikingOn",type:"checkbox",value:e.hikingOn,onChange:r})),i.a.createElement("label",null,i.a.createElement("a",{href:"http://hikebikemap.org"},"wmflabs Hike Bike "),i.a.createElement("input",{name:"hikebikeOn",type:"checkbox",value:e.hikebikeOn,onChange:r})),i.a.createElement("label",null,i.a.createElement("a",{href:"http://hikebikemap.org"},"wmflabs Hillshading "),i.a.createElement("input",{name:"hillshadingOn",type:"checkbox",value:e.hillshadingOn,onChange:r}))),e.redirect,i.a.createElement(se.b,{path:"/",component:oe}))},me=n(49),de=g.url.API_URL;var pe=function(e){var t=Object(a.useContext)(O),n=Object(a.useContext)(p),r=Object(a.useState)(null),c=Object(d.a)(r,2),l=c[0],o=c[1];return t.isAuthenticated||e.history.push("/"),Object(a.useEffect)(function(){fetch(de+"/api/profiles",{method:"GET",credentials:"include",headers:{Authorization:"Bearer "+t.jwToken}}).then(function(e){return e.json()}).then(function(e){o(e)})},[]),i.a.createElement("div",{className:"Profile"},l?i.a.createElement("div",{className:"flexcontainercolumn"},i.a.createElement("h2",null,l.user.name),i.a.createElement("h4",null,"Your locations:"),l.locations.map(function(e){return i.a.createElement(me.b,{to:"/location/"+e._id,key:e.name},e.name)}),i.a.createElement("h4",null,"Your favourites:"),l.user.favourites.map(function(e){return i.a.createElement(me.b,{to:"/location/"+e,key:e.name},n.getPointIdData(e).name)})):i.a.createElement(j,{size:80,loading:!0}))},he=n(105),be=n.n(he),fe=g.url.API_URL;var ge=function(){var e=Object(a.useContext)(O),t=Object(a.useContext)(p),n=e.picture?i.a.createElement(ae,{src:e.picture,alt:"Profile"}):"Profile";return i.a.createElement(me.a,{basename:"/Tently"},i.a.createElement("nav",{className:"navbar navbar-dark bg-dark"},i.a.createElement(me.b,{to:"/location"},i.a.createElement("h1",{className:"text-light title"},"Tently")),e.isAuthenticated?i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){e.setIsAuthenticated(!1),e.setUser(null),e.setJwToken(null),t.setMode("explore")},className:"button"},"Log out"),i.a.createElement(me.b,{to:"/profile"},n)):i.a.createElement(be.a,{appId:g.app_id.FACEBOOK_APPID,autoLoad:!0,fields:"name,email,picture",callback:function(t){var n={method:"POST",body:"access_token=".concat(t.accessToken),headers:{"Content-Type":"application/x-www-form-urlencoded"},mode:"cors",cache:"default"};fetch(fe+"/api/auth/facebook",n).then(function(t){var n=t.headers.get("x-auth-token");t.json().then(function(t){n&&(e.setIsAuthenticated(!0),e.setUser(t._id),e.setJwToken(n),e.setPicture(t.photoUrl))})})}})),i.a.createElement(se.d,null,i.a.createElement(se.b,{path:"/location",component:ue}),i.a.createElement(se.b,{exact:!0,path:"/"},i.a.createElement(se.a,{to:"/location"})),i.a.createElement(se.b,{path:"/profile",component:pe})))};n(132),n(133);c.a.render(i.a.createElement(h,null,i.a.createElement(y,null,i.a.createElement(ge,null))),document.getElementById("root"))},96:function(e,t,n){e.exports=n.p+"static/media/012-camp.8f0eb9f0.svg"},97:function(e,t,n){e.exports=n.p+"static/media/010-bonfire.21b76057.svg"},98:function(e,t,n){e.exports=n.p+"static/media/009-binoculars.6b6a714c.svg"},99:function(e,t,n){e.exports=n.p+"static/media/032-hut.f466d3ec.svg"}},[[120,1,2]]]);
//# sourceMappingURL=main.60dc983f.chunk.js.map